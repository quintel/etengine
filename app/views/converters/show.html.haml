%html
  %head
    = stylesheet_link_tag 'converter_details'
  %body#converter_detail
    - if @converter_present && @converter_future
      :ruby
        @pre = @converter_present.query
        @fut = @converter_future.query
        items = @converter_present.converter_api.relevant_attributes

        # Some converters require custom information
        #
        carriers = @converter_present.input_carriers.map &:key
        if coal_and_wp = (carriers.include?(:coal) && carriers.include?(:wood_pellets))
          old = items
          new = {}
          new["Technical **"] = old[:technical]
          new["Current Fuel Input Mix"] = {}
          new["Costs **"] = old[:cost]
          new["Other"] = old[:other]

          @converter_present.input_links.each do |link|
            new["Current Fuel Input Mix"]["#{link.carrier.key}_input_conversion"] = [link.carrier.key.to_s.humanize, '%']
          end
          items = new
        end


      = render :partial => "data/converters/details", :locals => {:attr_groups => items}

      - if (@converter_present.groups & [:cost_traditional_heat, :cost_electricity_productions, :cost_heat_pumps, :cost_chps]).empty?
        No converter details specified

      - if coal_and_wp
        %p
          ** The fuel input mix of this plant can be changed by your slider settings. Doing so changes both technical and cost parameters in this table.
      %p
        For questions about these data, please contact:
        = mail_to 'alexander.wirtz@quintel.com'
    - else
      %p Converter information not available