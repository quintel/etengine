= sprocket_layout_init :senkey
= javascript_include_tag 'underscore.min' # underscore does not work with sprockets :(

#blueprint_layout
  %strong#graph_saving{:style => 'background: #f00; color: #fff; display: none'} Saving...
    
  %ul
    %li
      = link_to 'save', '#', :onclick => 'update_positions()'
      (Shortcut: ALT+S)
    %li ALT + click to select/deselect multiple converters
    %li Shift + click: highlight links
    %li ALT + Shift + click: hide converter
    %li Double-click on converter to open details in new converter
    %li
      = link_to 'deselect all (ALT+D)', 'javascript:GRAPH.deselect_all()'
      |
      = link_to 'highlight off (ALT+H)', 'javascript:GRAPH.highlight_off_all()'
      
    %li Search for converters using id (with #) using Ctrl+F. For low ids, finish search with a ".", e.g. #30.

    %li= graphviz_attribute_selector
    %li= graphviz_toggle_sectors

  %script
    == var data_json_url = "#{edit_data_blueprint_layout_path(:id => @blueprint_layout, :format => 'json')}";
    
  = render 'initialize_graph'

  :javascript
    function update_positions(evt) {
      evt.preventDefault();
      $('#graph_saving').text('Saving...').show();
      $.ajax({
        type: 'POST',
        url: update_converter_positions_path, 
        data: {'converter_positions' : getUpdatedValues()},
        success: function(data) { $('#graph_saving').fadeOut(); },
        error: function(data) { $('#graph_saving').text('ERROR'); }
      });
      updated_coordinates = {};
      return false;
    };
    
    
    GRAPH.enableDragging();
    $(document).bind('keydown', 'alt+d', GRAPH.deselect_all);
    $(document).bind('keydown', 'alt+s', update_positions);
    $(document).bind('keydown', 'alt+h', GRAPH.highlight_off_all);
