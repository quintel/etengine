// GRAPH is uppercase to make it obvious that it is in global namespace!
var GRAPH = new Graph();

<%
converter_keys = @converters.map(&:key)

@converters.each do |converter|
  position = @positions[converter.key]
  params = [converter.key,
            position[:x] || 100,
            position.y_or_default(converter),
            converter.sector_key,
            converter.use_key,
            (position.hidden == true),
            position.fill_color(converter),
            position.stroke_color(converter)]
-%>
<%= "new Converter(#{params.to_json});".html_safe %>
<% end %>


<% @converters.map(&:input_links).flatten.uniq.each do |link|
  if converter_keys.include?(link.lft_converter.key) and converter_keys.include?(link.rgt_converter.key)
    params = [
      link.rgt_converter.key,
      link.lft_converter.key,
      (link.carrier.graphviz_color || '#999'),
      '1|-'   #"1|#{link.link_style}"
    ]
    -%>
    <%= "new Link(#{params.to_json});".html_safe %>
  <% end %>
<% end %>

GRAPH.draw();
